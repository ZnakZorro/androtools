<!DOCTYPE html>
<html>
  <head>
    <title>Acceleration Example</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>	
body {margin:0; padding:0;}
</style>
    <script type="text/javascript" charset="utf-8" src="cordova-2.2.0.js"></script>
	<script type="text/javascript" charset="utf-8" src="kapiszon.js"></script>
    <script type="text/javascript" charset="utf-8">

    // The watch id references the current `watchAcceleration`
    var watchID = null;

    // Wait for Cordova to load
    //
	    function onLoad() {
			try  {if (device.uuid) document.addEventListener("deviceready", onDeviceReady, false);}
			catch(er){onDeviceReady();}
			//onDeviceReady();
		}
   

    // Cordova is ready
    //
    function onDeviceReady() {
	try {if (device.uuid) $('#test3').innerHTML='<div>'+device.uuid+'</div>';}
	catch(er){$('#test3').innerHTML='<div>PCet</div>';}
        startWatch();
    }

    // Start watching the acceleration
    //
    function startWatch() {

        // Update acceleration every 1 seconds
        var options = { frequency: 333 };
		watchID = navigator.accelerometer.watchAcceleration(onSuccess, onError, options);
	//try {if (device.uuid) watchID = navigator.accelerometer.watchAcceleration(onSuccess, onError, options);}
	//catch(er){symulacja();}
    }
	
	function symulacja(){
	var it=window.setInterval(function(){
			var acceleration={};
			acceleration.x=(Math.random()*20)-10;
			acceleration.y=(Math.random()*20)-10;
			acceleration.z=(Math.random()*10);
			acceleration.timestamp=111111;
			//console.log(acceleration);
			onSuccess(acceleration);
			return acceleration;
		},333);
	}
    // Stop watching the acceleration
    //
    function stopWatch() {
        if (watchID) {
            navigator.accelerometer.clearWatch(watchID);
            watchID = null;
        }
    }

    // onSuccess: Get a snapshot of the current acceleration
    //
    function onSuccess(acceleration) {
        var element = document.getElementById('accelerometer');
		
		if(acceleration){
        element.innerHTML = 'Acceleration X: ' + acceleration.x + '<br />' +
                            'Acceleration Y: ' + acceleration.y + '<br />' +
                            'Acceleration Z: ' + acceleration.z + '<br />' +
                            'Timestamp: '      + acceleration.timestamp + '<br />';
		}
		rysuj(acceleration);
    }

    // onError: Failed to get the acceleration
    //
    function onError() {
        alert('onError!');
    }

		//var c=document.getElementById("myCanvas");
		//var ctx=c.getContext("2d");
	
function rysuj(acceleration){
		var c=document.getElementById("myCanvas");
		var ctx=c.getContext("2d");

	var dmax=60;
	var xmax=398;
	var ymax=398;
	var pol=200;
	
		try {
			var z=skala(acceleration.z,10);
	    	var x=skala(acceleration.x,20); x=xmax-((x-(z/2))+pol);
			var y=skala(acceleration.y,20); y=(y-(z/2))+pol;
			var t=acceleration.timestamp;
		} catch(er)
		{
			var z=Math.round((Math.random()*(dmax*0.8))+(dmax*0.2));
			var x=Math.round((Math.random()*(xmax-z)));
			var y=Math.round((Math.random()*(ymax-z)));	
			var t=Math.random();	
		}
		//console.log(d+ ' ' +xlos+ ' ' +ylos);
	ctx.fillStyle="#ffffff";
	ctx.fillRect(0,0,xmax,ymax);	
	ctx.fillStyle="#800000";
	ctx.fillRect(x,y,z,z);
	$('#accelerometer').innerHTML+='<hr />x='+x+'<br />'+'y='+y+'<br />'+'z='+z+'<br />'+'t='+t;
	
}	
function skala(v,s){
	var a=((v)*s);
	return Math.round(a);
}	
	
	
    </script>
  </head>
<body onload="onLoad()">
	<canvas id="myCanvas" width="398" height="398" style="float:left; border:1px solid gray;"></canvas>

    <div id="test3">...</div>
    <div id="accelerometer">Waiting for accelerometer...</div>
  </body>
</html>





